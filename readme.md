#### HTTP API

### Добавить товар в корзину
| Метод | URI                                             |
|-------|-------------------------------------------------|
| POST  | /user/<user_id>/cart/<sku_id>                   |

**Параметры запроса:**

| Параметр | Тип параметра | Тип данных | Пример | Описание                                                        |
|----------|---------------|------------|--------|-----------------------------------------------------------------|
| user_id  | query path    | int64      | 1007   | Идентификатор пользователя в корзину которого добавляется товар |
| sku_id   | query path    | int64      | 2008   | Идентификатор товара, добавляемого в корзину                    |
| count    | body          | uint16     | 12     | Количество товаров, добавляемое в корзину                       |

**Параметры ответа:**

отсутствуют

### Удалить товар из корзины
| Метод  | URI                                             |
|--------|-------------------------------------------------|
| DELETE | /user/<user_id>/cart/<sku_id>                   |

**Параметры запроса:**

| Параметр | Тип параметра | Тип данных | Пример | Описание                                                        |
|----------|---------------|------------|--------|-----------------------------------------------------------------|
| user_id  | query path    | int64      | 1007   | Идентификатор пользователя в корзину которого добавляется товар |
| sku_id   | query path    | int64      | 2008   | Идентификатор товара, удаляемого из корзины                     |

**Параметры ответа:**

отсутствуют

### Очистить корзину пользователя
| Метод  | URI                  |
|--------|----------------------|
| DELETE | /user/<user_id>/cart |

**Параметры запроса:**

| Параметр | Тип параметра | Тип данных | Пример | Описание                                                        |
|----------|---------------|------------|--------|-----------------------------------------------------------------|
| user_id  | query path    | int64      | 1007   | Идентификатор пользователя в корзину которого добавляется товар |

**Параметры ответа:**

отсутствуют

### Получить содержимое корзины
| Метод | URI                      |
|-------|--------------------------|
| GET   | /user/<user_id>/cart     |

**Параметры запроса:**

| Параметр | Тип параметра | Тип данных | Пример | Описание                                                        |
|----------|---------------|------------|--------|-----------------------------------------------------------------|
| user_id  | query path    | int64      | 1007   | Идентификатор пользователя в корзину которого добавляется товар |

**Параметры ответа:**

| Параметр        | Тип данных | Пример                                           | Описание                                     |
|-----------------|------------|--------------------------------------------------|----------------------------------------------|
| items[i].sku_id | int64      | 2008                                             | Идентификатор товара в корзине пользователя  |
| items[i].name   | string     | "Гречка пропаренная, в пакетиках для варки, 400" | Наименование товара                          |
| items[i].count  | uint16     | 10                                               | Количество единиц товара                     |
| items[i].price  | uint32     | 16                                               | Стоимость единицы товара в условных единицах |
| total_price     | uint32     | 160                                              | Суммарная стоимость всех товаров в корзине   |


**Пример ответа:**

```json
{
    "items" : [
        {
            "sku_id": 2958025,
            "name": "Roxy Music. Stranded. Remastered Edition",
            "count": 2,
            "price": 1028
        },
        {
            "sku_id": 773297411,
            "name": "Кроссовки Nike JORDAN",
            "count": 1,
            "price": 2202
        }
    ],
    "total_price": 4258
}
```

### Создать заказ из корзины
| Метод  | URI                           |
|--------|-------------------------------|
| POST   | /user/<user_id>/cart/checkout |

**Параметры запроса:**

| Параметр | Тип параметра | Тип данных | Пример | Описание                                                        |
|----------|---------------|------------|--------|-----------------------------------------------------------------|
| user_id  | query path    | int64      | 1007   | Идентификатор пользователя в корзину которого добавляется товар |

**Параметры ответа:**

| Параметр        | Тип данных | Пример                                           | Описание                                     |
|-----------------|------------|--------------------------------------------------|----------------------------------------------|
| orderID         | int64      | 2008                                             | Идентификатор созданного заказа              |

**Пример ответа:**

```json
{
    "orderID": 2008
}
```

#### GRPC API
### Создать заказ в LOMS (Logistics and Order Management System)
| Метод       | Пример                                                | 
|-------------|-------------------------------------------------------|
| OrderCreate | {"order":{"userId":"0","items":[{"sku":0,"count":0}]}}

**Параметры запроса:**

| Параметр | Тип данных                 | Пример                     | Описание                                                        |
|----------|----------------------------|----------------------------|-----------------------------------------------------------------|
| user_id  | int64                      | 1007                       | Идентификатор пользователя в корзину которого добавляется товар |
| items    | {sku uint32, count uint32} | {sku 2958025, count 1}     | Товары добавляемые в заказ                                      |

**Пример ответа:**

```json
{
    "order_id": 2008
}
```

### Получить инфо о заказе в LOMS (Logistics and Order Management System)
| Метод       | Пример          | 
|-------------|-----------------|
| OrderGetInfo | {"orderId":"1"}

**Параметры запроса:**

| Параметр | Тип данных                 | Пример                     | Описание              |
|----------|----------------------------|----------------------------|-----------------------|
| order_id  | int64                      | 1007                       | Идентификатор заказа |

**Пример ответа:**

```json
{
  "status": "STATUS_AWAITING_PAYMENT",
  "user_id": "31337",
  "items": [
    {
      "sku": 773297411,
      "count": 40
    },
    {
      "sku": 5415913,
      "count": 30
    }
  ]
}
```

### Оплатить заказ в LOMS (Logistics and Order Management System)
| Метод    | Пример         | 
|----------|----------------|
| OrderPay | {"orderId":"1"}

**Параметры запроса:**

| Параметр | Тип данных                 | Пример                     | Описание              |
|----------|----------------------------|----------------------------|-----------------------|
| order_id  | int64                      | 1007                       | Идентификатор заказа |

**Пример ответа:**

```json
{}
```

### Отменить заказ в LOMS (Logistics and Order Management System)
| Метод       | Пример         | 
|-------------|----------------|
| OrderCancel | {"orderId":"1"}

**Параметры запроса:**

| Параметр | Тип данных                 | Пример                     | Описание              |
|----------|----------------------------|----------------------------|-----------------------|
| order_id  | int64                      | 1007                       | Идентификатор заказа |

**Пример ответа:**

```json
{}
```

### Проверить наличие товара в LOMS (Logistics and Order Management System)
| Метод             | Пример         | 
|-------------------|----------------|
| OrderGetStockInfo | {"sku":2958025}

**Параметры запроса:**

| Параметр | Тип данных                 | Пример                     | Описание                       |
|----------|----------------------------|----------------------------|--------------------------------|
| sku      | uint32	                    | 2958025                    | Идентификатор товара на складе |

**Пример ответа:**

```json
{
  "count": "25"
}
```

# Путь покупки товаров:

- cart/item/add - добавляем в корзину и проверяем, что есть в наличии
- cart/item/delete удалить из корзины
- cart/list - получить список товаров корзины
- cart/checkout - приобретение товаров через Checkout
- order/pay оплачиваем заказ
- order/cancel отмена заказа до оплаты

# GRPC
    - protoc
    - protoc-dependencies, protoc-generate, lomsGRPCUI - UI for GRPC requests
# Testing
    - testify, minimock, gocyclo, gocognit
    - cartServiceMockGen, lomsServiceMockGen
# SQL
    - sqlc, goose go
    - upMigrationsOrdersDB, downMigrationOrdersDB, statusOrdersDB
    - upMigrationsStocksDB, downMigrationStocksDB, statusStocksDB, resetStocksDB
# Kafka
    - sarama
    - everything is configurated in docker-compose
    - сообщает о смене статуса заказа в сервис notifier

# ENV file
```bash
# postgres
POSTGRES_USER
POSTGRES_PASSWORD
DATABASE_HOST

# goose
GOOSE_DRIVER
GOOSE_STOCKS_DBSTRING
GOOSE_ORDERS_DBSTRING

# kafka-ui
KAFKA_CLUSTERS_0_NAME
KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS

# kafka
KAFKA_NODE_ID
KAFKA_LISTENER_SECURITY_PROTOCOL_MAP
KAFKA_ADVERTISED_LISTENERS
KAFKA_LISTENERS
KAFKA_CONTROLLER_LISTENER_NAMES
KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR
KAFKA_TRANSACTION_STATE_LOG_MIN_ISR
KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR
KAFKA_CONTROLLER_QUORUM_VOTERS
KAFKA_PROCESS_ROLES
KAFKA_LOG_DIRS
CLUSTER_ID
```
